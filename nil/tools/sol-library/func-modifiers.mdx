# Function modifiers

The =nil; Solidity library provides several function modifiers that simplify the processing of external messages and async calls.


## `onlyInternal` and `onlyExternal`

=nil; adds the following function modifiers:

* `onlyInternal`
* `onlyExternal`

If a function has the `onlyInternal` modifier, it can only be called by another smart contract regardless of where this contract is located. A function with the `onlyExternal` modifier behaves the opposite way: it must always be called via an external message (e.g., from a user).

:::info

It is technically possible to call a function marked with `onlyExternal`/`onlyInternal` modifier with message whose type is opposite to the type in the modifier. However, such a call will produce an error.

:::

Consider the below examples. Contract 1 is a basic contract for voting:

```solidity showLineNumbers
import "./Nil.sol";

contract Elections {

    using Nil for address; 

    mapping(string => uint256) public votes;

    mapping(bytes => bool) private voters;

    function requestVote(address dst, string candidate) onlyExternal public {
        dst.asyncCall(address(0), 5000, false, msg.value, abi.encodeWithSignature("verify_vote(string)", candidate));
    }

    function addVote(string candidate) onlyInternal public {
        votes[candidate]++;
    }

    function verifyExternal(uint256 seqno, bytes calldata authData) external view returns (bool) {
        if voters[authData] == true {
            return true;
        } else {
            return false;
        }
    }
}
```

Contract 2 holds simple verification logic:

```solidity showLineNumbers
import "./Nil.sol";

contract Verifier {

    using Nil for address; 

    mapping(string => bool) private candidateStatuses; 

    function verifyVote(address dst, string candidate) public {
        if candidateStatuses[candidate] != false {
            dst.async_call(address(0), gas_left(), false, msg.value, abi.encodeWithSignature("addVote(string)", candidate));
        } 
    }
}
```

Contract 1 makes an async call to Contract 2 requesting Contract 2 to verify whether a candidate is invalid. If the candidate's value in the `candidateStatuses` mapping is `true`, Contract 2 calls the `addVote()` function inside Contract 1. 

The use of modifiers protects this system from being abused. Outside parties cannot directly add votes as the `addVote` function has the `onlyInternal` modifier. In contrast, the `requestVote()` function is `onlyExternal`, and it is the only way a user or a dApp can register their vote.

Note that Contract 2 lacks the `verifyExternal()` function and, therefore, cannot accept external messages. This means that `verifyVote()` does not need to have the `onlyInternal` modifier. Vote verification in Contract 2 can only be initiated by another contract.




